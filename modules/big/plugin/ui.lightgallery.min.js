define(function(){return function(a,b){var c=b.ui.LightGallery=function(c,d){var u,v,w,x,A,B,C,D,E,F,G,H,I,J,K,e=this,f=b.isType("json",d)?d:{},g=this._targets=a(c).find("[data-light-path]"),h=this._wrapper=a('<div class="-light-gallery"></div>').css({visibility:"hidden"}),i=this._mask=a('<div class="-light-gallery-mask"></div>'),j=this._origin=a('<div class="-light-gallery-origin"></div>'),k=this._container=a('<div class="-light-gallery-container"></div>'),l=this._imageBox=a('<div class="-light-gallery-image"></div>'),m=this._descBox=a('<div class="-light-gallery-desc"><b></b></div>'),n=this._desc=a("<p></p>"),o=this._closeBtn=a('<a class="-light-gallery-close-btn"><i></i><b></b></a>'),p=a('<div class="-light-gallery-loader"></div>'),q=q=a('<a class="-light-gallery-nav prev-btn"><i></i><b></b></a>'),r=r=a('<a class="-light-gallery-nav next-btn"><i></i><b></b></a>'),s=this._params={speed:b.isType("number",f.speed)?f.speed:400,easing:b.isType("string",f.easing)?b.getEasing(f.easing):b.getEasing("easeInOutQuart"),loop:b.isType("boolean",f.loop)?f.loop:!1},t=[],y=b.getRandom(),z=null;this.onReady=f.onReady,m.append(n),k.append(l).append(m),j.append(k).append(o).append(p).append(q).append(r),h.append(i).append(j),a(document.body).append(h),A=function(a){o[a]("click",H),i[a]("click",H)},B=function(a){var c,b=t.length-1;switch(s.loop){case!0:switch(a){case"prev":c=0==u?b:u-1;break;case"next":c=u==b?0:u+1}break;case!1:switch(a){case"prev":c=u-1,0>=c&&(q.stop().animate({left:5,opacity:0},s.speed,function(){q.hide()}),b>1&&r.show().stop().animate({right:15,opacity:1},s.speed));break;case"next":c=u+1,c>=b&&(r.stop().animate({right:5,opacity:0},s.speed,function(){r.hide()}),b>1&&q.show().stop().animate({left:15,opacity:1},s.speed))}}return c},C=function(a){var b=t.length-1;switch(s.loop){case!0:switch(a){case"prev":q.show().stop().animate({left:15,opacity:1},s.speed),r.stop().animate({right:5,opacity:0},s.speed,function(){r.hide()});break;case"next":q.stop().animate({left:5,opacity:0},s.speed,function(){q.hide()}),r.show().stop().animate({right:15,opacity:1},s.speed);break;case"none":q.stop().animate({left:5,opacity:0},s.speed,function(){q.hide()}),r.stop().animate({right:5,opacity:0},s.speed,function(){r.hide()})}break;case!1:switch(a){case"prev":0>=u?q.stop().animate({left:5,opacity:0},s.speed,function(){q.hide()}):q.show().stop().animate({left:15,opacity:1},s.speed),r.stop().animate({right:5,opacity:0},s.speed,function(){r.hide()});break;case"next":q.stop().animate({left:5,opacity:0},s.speed,function(){q.hide()}),u>=b?r.stop().animate({right:5,opacity:0},s.speed,function(){r.hide()}):r.show().stop().animate({right:15,opacity:1},s.speed);break;case"none":q.stop().animate({left:5,opacity:0},s.speed,function(){q.hide()}),r.stop().animate({right:5,opacity:0},s.speed,function(){r.hide()})}}v=a},D=function(a){var c=g.eq(a),d=c.offset(),e=b.getSize(c);return{opacity:0,width:e.width,height:e.height,left:d.left-b.size.left,top:d.top-b.size.top,marginTop:0,marginLeft:0}},E=function(a){var c,d,e;switch(a.complete){case!0:e=b.getSize(j,{preset:{width:0,height:0}}),c=F(a),d=b.getFixed({offset:5,attach:!1,range:0,width:c.width+e.width,height:c.height+e.height},{fixed:!0,style:{opacity:1,width:c.width,height:c.height}});break;case!1:c=b.getSize(j),d=b.getFixed({offset:5,attach:!1,range:0,width:c.width,height:c.height},{fixed:!0,style:{opacity:1,width:c.width,height:c.height}})}return d},F=function(a){var c,f,g,d=b.size.width-88,e=b.size.height-88;return w&&w&&w>a.width||x>a.height?(f=w,g=x):(f=a.width,g=a.height),(f>d||g>e)&&(e>d?(c=f/g,f=d,g=d/c):(c=g/f,g=e,f=e/c)),{width:f,height:g}},G=this.zoomShow=function(c){a(document.body).append(h);var d=D(c),f=E(t[c].img);b.ui.toggleBlur(y,{target:h,callback:function(){j.css(d),h.css({zIndex:b.getZIndex(h)}).fadeIn(s.speed,function(){I(c),j.animate(f,s.speed,function(){A("on"),b.isType("function",e.onShow)&&e.onShow(e)})})}})},H=this.zoomHide=function(){var a=D(u);A("off"),k.fadeOut(s.speed,function(){j.animate(a,s.speed,function(){b.ui.toggleBlur(y,{callback:function(){h.fadeOut(b.resetTime(s.speed,0),function(){l.empty(),m.hide(),k.show(),h.detach(),b.isType("function",e.onHide)&&e.onHide(e)})}})})})},I=this.imageLoad=function(a){if(a>=t.length||0>a)return!1;var b=t[a].img,c=l.children("img"),d=t[a].desc;switch(b.style.display="block",w=b.width,x=b.height,u=e._active=a,b.complete){case!0:J(b,d);break;case!1:switch(c.length>0){case!0:c.fadeOut(s.speed,function(){z.play()});break;case!1:z.play()}b.onload=function(){J(b,d)},b.src=b.src}},J=function(a,c){var d=F(a),e=b.getSize(j,{preset:{width:d.width,height:d.height}}),f=b.getFixed({offset:5,attach:!1,range:0,width:e.width,height:e.height},{fixed:!0,style:{width:d.width,height:d.height}});k.fadeOut(s.speed,function(){l.empty().append(a),c&&""!=c?(m.show(),n.text(c)):(m.hide(),n.empty()),z._status?z.stop(function(){j.animate(f,s.speed,s.easing,function(){k.fadeIn(s.speed)})}):j.animate(f,s.speed,s.easing,function(){k.fadeIn(s.speed)})})},K=function(){var a=l.children("img").get(0);a&&j.css(E(a))},function(){b.each(g,function(b,c){var f,d=a(c),e=new Image;e.src=d.data("light-path"),f=d.data("light-desc"),t.push({img:e,desc:f})}),b.ui.keepFull(h,{callback:function(){new b.ui.ScrollFollow(h,{offset:1})}}),function(){var a=b.getSize(q),c=b.getSize(r);q.css({top:"50%",marginTop:-a.height/2,display:"none"}),r.css({top:"50%",marginTop:-c.height/2,display:"none"}),z=new b.ui.CycleLoader({target:p,offset:60,step:75,speed:55}),h.css({visibility:"visible"}).detach()}(),function(){g.on("click",function(){G(a(this).index())}),q.on("click",function(){I(B("prev"))}),r.on("click",function(){I(B("next"))}),k.on("mousemove",function(a){var c,e,f,g,l,h,i;a.offsetX?(c=a.offsetX,a.offsetY):(e=k.offset(),f=e.left-b.size.left,g=e.top-b.size.top,c=a.clientX-f,a.clientY-g),h=b.getSize(this),i=h.width/2,h.height/2,l=c>i?"next":"prev",v!=l&&C(l)}),j.on("mouseout",function(a){(a.currentTarget==a.relatedTarget||a.relatedTarget==i[0])&&C("none")}),b.evt.onResize(K),b.isType("function",e.onReady)&&e.onReady(e)}()}()};return c}});