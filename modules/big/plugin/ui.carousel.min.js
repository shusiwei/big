define(function(){"use strict";return function(a,b){var c=b.ui.Carousel=function(c,d){var u,v,w,x,y,z,A,B,e=this,f=b.isType("json",d)?d:{},g=this._wrapper=a(c).addClass("-carousel"),h=this._ul=this._wrapper.children("ul:first").addClass("-carousel-container"),i=this._lis=this._ul.children("li"),j=i.length,k=j-1,l=null,m=this._prop={width:h.width(),height:h.height(),row:b.isType("number",f.row)?f.row:4,scale:b.isType("number",f.scale)&&f.scale<=.8&&f.scale>=.2?f.scale:.5,pagination:b.isType("boolean",f.pagination)?f.pagination:!1,navigation:b.isType("json",f.navigation)||b.isType("boolean",f.navigation)?f.navigation:!1},n=this._params={speed:b.isType("number",f.speed)?f.speed:500,autoplay:b.isType("boolean",f.autoplay)&&0==f.autoplay?!1:b.isType("number",f.autoplay)?f.autoplay:3e3,easing:b.isType("string",f.easing)?b.getEasing(f.easing):b.getEasing("easeInOutBack")},o=void 0,p=[],q=void 0,r=this._pagers=null,s=this._prevBtn=null,t=this._nextBtn=null;this.onReady=f.onReady,this.onChangeStart=f.onChangeStart,this.onChangeEnd=f.onChangeEnd,u=function(a){var c,d,b=[];for(c=a;j>c;c++)b.push(i[c]);for(d=0;a>d;d++)b.push(i[d]);return b},v=function(a){var b;return"prev"===a?b=0===o?k:o-1:"next"===a&&(b=o===k?0:o+1),b},w=this.bindEvent=function(b){switch(b){case"on":i.each(function(b,c){b==o?a(c).off("click",l.list[b]):a(c).on("click",l.list[b])}),m.pagination&&r.each(function(b,c){a(c).on("click",l.page[b])}),m.navigation&&(s.on("click",l.prev),t.on("click",l.next));break;case"off":i.each(function(b,c){a(c).off("click",l.list[b])}),m.pagination&&r.each(function(b,c){a(c).off("click",l.page[b])}),m.navigation&&(s.off("click",l.prev),t.off("click",l.next))}},x=this.startPlay=function(){n.autoplay&&(y(),q=setTimeout(function(){A(),x()},n.autoplay))},y=this.stopPlay=function(){clearTimeout(q)},z=this.playPrev=function(){B(v("prev"),!0,"prev")},A=this.playNext=function(){B(v("next"),!0,"next")},B=this.playTo=function(c,d,f){if(c===o)return!1;var g=u(c);b.isType("function",e.onChangeStart)&&d===!0&&e.onChangeStart(o,c,f),w("off"),"init"===f?(b.each(g,function(b,c){a(c).css(p[b])}),h.css({height:b.getSize(g[0]).height})):b.each(g,function(b,c){a(c).animate(p[b],n.speed,n.easing)}),i.eq(o).removeClass("active"),i.eq(c).addClass("active"),r&&(r.eq(o).removeClass("active"),r.eq(c).addClass("active")),setTimeout(function(){b.isType("function",e.onChangeEnd)&&d===!0&&e.onChangeEnd(c,o,f),o=e._active=c,w("on")},n.speed)},function(c){!function(){var a=i[0],c=b.getSize(a),d=b.getSize(a,{preset:{width:0,height:0}}),e={width:c.width-d.width,height:c.height-d.height},f={width:e.width*m.scale,height:e.height*m.scale},g=(m.width-c.width)/2,h={width:(c.width-f.width)/m.row,height:(c.height-f.height)/m.row,opacity:1/m.row,left:g/(m.row-1)},k=[];b.each(m.row,function(a){var c,i,j,b=m.row-a;switch(a){case 0:c=e.width,i=e.height,j=g;break;case m.row-1:c=f.width,i=f.height,j=0;break;default:c=f.width+h.width*b,i=f.height+h.height*b,j=h.left*(b-1)-d.width/2}k.push({width:c,height:i,left:j,zIndex:b,opacity:b*h.opacity,marginTop:-(i+d.height)/2})}),b.each(function(){var b,c,d,a=[];for(b=0;b<m.row;b++)a.push(b);for(c=m.row;c<j-m.row+1;c++)a.push(m.row-1);for(d=j-m.row+1;j>d;d++)a.push(j-d);return a}(),function(a,c){var e,f;j-a<=m.row-1?(f=b.mergeJSON(k[c],{}),e=b.mergeJSON({left:m.width-k[j-a].left-f.width-d.width},f)):a>=m.row?(f=b.mergeJSON(k[c],{}),e=b.mergeJSON({left:(m.width-f.width-d.width)/2,opacity:0},f)):e=k[c],p.push(e)})}(),function(b){var c,d;if(!b)return!1;for(c=a('<div class="-carousel-pagination"></div>'),d=0;j>d;d++)!function(b){var d=a('<a class="rel-'+(b+1)+'">'+(b+1)+"</a>");c.append(d)}(d);r=e._pagers=c.find("a"),m.pagination&&g.append(c)}(m.pagination),function(c){return c?(s=e._prevBtn=a('<a class="-carousel-nav prev-btn"></a>'),t=e._nextBtn=a('<a class="-carousel-nav next-btn"></a>'),m.navigation&&(g.append(s).append(t),b.isType("json",m.navigation)&&m.navigation.icon&&(s.append("<i></i>"),t.append("<i></i>"),m.navigation.under&&(s.append("<b></b>"),t.append("<b></b>")))),void 0):!1}(m.navigation),function(){l={list:[],page:[],prev:z,next:A},b.each(j,function(a){l.list.push(function(){B(a,!0,"click")}),l.page.push(function(){B(a,!0,"page")})})}(),function(){g.on("mouseover",y),g.on("mouseout",x),w("on"),b.isType("function",e.onReady)&&e.onReady(e)}(),B(c,!0,"init"),x()}(b.isType("number",f.active)&&f.active<=k&&f.active>=0?f.active:0)};return c}});